<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Agendamento Barbearia</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
    }

    h1 {
        color: white;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        font-size: 2.5em;
        margin-bottom: 30px;
    }

    .container {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        max-width: 800px;
        width: 100%;
    }

    #calendario {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 15px;
        margin: 20px 0;
    }

    .cabecalho-semana {
        background: #667eea;
        color: white;
        padding: 12px;
        text-align: center;
        font-weight: bold;
        border-radius: 10px;
        font-size: 14px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .dia {
        background: #f8f9fa;
        padding: 20px;
        text-align: center;
        border-radius: 15px;
        cursor: pointer;
        font-size: 18px;
        font-weight: 600;
        transition: all 0.3s ease;
        border: 2px solid transparent;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .dia:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .disponivel {
        background: linear-gradient(135deg, #4CAF50, #45a049);
        color: white;
        border-color: #4CAF50;
    }

    .indisponivel {
        background: #e9ecef;
        color: #6c757d;
        cursor: not-allowed;
    }

    .finalSemana {
        background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        color: white;
        cursor: not-allowed;
    }

    #servicos {
        margin: 30px 0;
        text-align: center;
    }

    #servicos h2 {
        color: #333;
        margin-bottom: 25px;
        font-size: 1.8em;
    }

    .servicos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .servico-card {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 25px 20px;
        border-radius: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        font-size: 16px;
        font-weight: 600;
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }

    .servico-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
    }

    #horarios {
        margin: 30px 0;
        text-align: center;
    }

    #horarios h2 {
        color: #333;
        margin-bottom: 25px;
        font-size: 1.8em;
    }

    .horarios-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }

    .horario-card {
        background: linear-gradient(135deg, #4CAF50, #45a049);
        color: white;
        padding: 20px 15px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        font-size: 16px;
        font-weight: 600;
        box-shadow: 0 6px 15px rgba(76, 175, 80, 0.3);
    }

    .horario-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(76, 175, 80, 0.4);
    }

    .horario-card:disabled {
        background: #e9ecef !important;
        color: #6c757d !important;
        cursor: not-allowed !important;
        transform: none !important;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1) !important;
    }
</style>
</head>
<body>

<h1>‚úÇÔ∏è Agendamento da Barbearia</h1>

<div class="container">
    <div id="calendario"></div>
    <div id="servicos"></div>
    <div id="horarios"></div>
</div>

<script type="module">

// ------------------------------------------
// 1. IMPORTAR FIREBASE
// ------------------------------------------
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

// ------------------------------------------
// 2. CONFIGURA√á√ÉO DO FIREBASE
// ------------------------------------------
const firebaseConfig = {
  apiKey: "AIzaSyBBcsGXfJf9sh5-x01Q9sHlVo_ymd_3Puk",
    authDomain: "barbearia-agendamentos-c2c21.firebaseapp.com",
    databaseURL: "https://barbearia-agendamentos-c2c21-default-rtdb.firebaseio.com",
    projectId: "barbearia-agendamentos-c2c21",
    storageBucket: "barbearia-agendamentos-c2c21.firebasestorage.app",
    messagingSenderId: "1059359416476",
    appId: "1:1059359416476:web:a84e0bd6fa9b5094bfcd59"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ------------------------------------------
// 3. HOR√ÅRIOS DISPON√çVEIS DO DIA
// ------------------------------------------
const horariosDia = [
  "09:00", "10:00", "11:00",
  "13:00", "14:00", "15:00", "16:00"
];

// ------------------------------------------
// 4. GERAR CALEND√ÅRIO
// ------------------------------------------
function gerarCalendario(ano, mes) {
    const data = new Date(ano, mes, 1);
    const ultimoDia = new Date(ano, mes + 1, 0).getDate();
    const calendario = document.getElementById("calendario");
    calendario.innerHTML = "";

    // Adicionar cabe√ßalhos dos dias da semana
    const diasSemana = ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'];
    diasSemana.forEach(inicial => {
        const cabecalho = document.createElement("div");
        cabecalho.classList.add("cabecalho-semana");
        cabecalho.innerText = inicial;
        calendario.appendChild(cabecalho);
    });

    // Adicionar espa√ßos vazios para o primeiro dia do m√™s
    const primeiroDiaSemana = new Date(ano, mes, 1).getDay();
    for (let i = 0; i < primeiroDiaSemana; i++) {
        const espacoVazio = document.createElement("div");
        calendario.appendChild(espacoVazio);
    }

    for (let dia = 1; dia <= ultimoDia; dia++) {
        const divDia = document.createElement("div");
        divDia.classList.add("dia");
        divDia.innerText = dia;

        const dataAtual = new Date(ano, mes, dia);
        const diaSemana = dataAtual.getDay(); // 0 = domingo, 6 = s√°bado

        // Se for s√°bado (6) ou domingo (0), marca como final de semana
        if (diaSemana === 0 || diaSemana === 6) {
            divDia.classList.add("finalSemana");
            // bloqueia clique
            divDia.onclick = () => alert("A barbearia n√£o atende aos finais de semana.");
        } else {
            divDia.onclick = () => selecionarDia(ano, mes, dia);
        }

        calendario.appendChild(divDia);
    }

    carregarDisponibilidadeDias(ano, mes);
}

// ------------------------------------------
// 5. MARCAR DIAS DISPON√çVEIS / INDISPON√çVEIS
// ------------------------------------------
function carregarDisponibilidadeDias(ano, mes) {
    const refMes = ref(db, `agendamentos/${ano}/${mes + 1}`);

    onValue(refMes, (snapshot) => {
        const dias = snapshot.val() || {};

        document.querySelectorAll(".dia").forEach(divDia => {
            const dia = divDia.innerText;
            const agendaDia = dias[dia] || {};

            const qtdAgendados = Object.keys(agendaDia).length;
            const qtdTotal = horariosDia.length;

            if (qtdAgendados >= qtdTotal) {
                divDia.classList.add("indisponivel");
            } else {
                divDia.classList.add("disponivel");
            }
        });
    });
}

// ------------------------------------------
// 6. SELECIONAR SERVI√áO E HOR√ÅRIOS
// ------------------------------------------
function selecionarDia(ano, mes, dia) {
    const diaFormatado = dia.toString().padStart(2, '0');
    const mesFormatado = (mes + 1).toString().padStart(2, '0');
    
    // Limpar hor√°rios e mostrar servi√ßos
    document.getElementById("horarios").innerHTML = "";
    
    const containerServicos = document.getElementById("servicos");
    containerServicos.innerHTML = `<h2>üéØ Escolha o servi√ßo para ${diaFormatado}/${mesFormatado}</h2>`;
    
    const servicosGrid = document.createElement("div");
    servicosGrid.classList.add("servicos-grid");
    
    const servicos = [
        "‚úÇÔ∏è Corte de Cabelo",
        "üßî Barba", 
        "üí´ Corte + Barba"
    ];
    
    servicos.forEach(servico => {
        const botao = document.createElement("button");
        botao.classList.add("servico-card");
        botao.innerText = servico;
        botao.onclick = () => mostrarHorarios(ano, mes, dia, servico);
        servicosGrid.appendChild(botao);
    });
    
    containerServicos.appendChild(servicosGrid);
}

function mostrarHorarios(ano, mes, dia, servicoSelecionado) {
    const refDia = ref(db, `agendamentos/${ano}/${mes + 1}/${dia}`);

    onValue(refDia, (snapshot) => {
        const horariosOcupados = snapshot.val() || {};
        exibirHorarios(horariosOcupados, ano, mes, dia, servicoSelecionado);
    });
}

function exibirHorarios(horariosOcupados, ano, mes, dia, servicoSelecionado) {
    const diaFormatado = dia.toString().padStart(2, '0');
    const mesFormatado = (mes + 1).toString().padStart(2, '0');
    
    const container = document.getElementById("horarios");
    container.innerHTML = `<h2>üïê Hor√°rios para ${diaFormatado}/${mesFormatado} - ${servicoSelecionado}</h2>`;

    const horariosGrid = document.createElement("div");
    horariosGrid.classList.add("horarios-grid");

    horariosDia.forEach(horario => {
        const botao = document.createElement("button");
        botao.classList.add("horario-card");
        botao.innerText = horario;

        if (horariosOcupados[horario]) {
            botao.disabled = true;
        }

        botao.onclick = () => agendar(ano, mes, dia, horario, servicoSelecionado);

        horariosGrid.appendChild(botao);
    });
    
    container.appendChild(horariosGrid);
}

// ------------------------------------------
// 7. AGENDAR HOR√ÅRIO
// ------------------------------------------
function agendar(ano, mes, dia, horario, servicoSelecionado) {
    const nome = prompt("Nome do cliente:");
    if (!nome) return;

    const telefone = prompt("N√∫mero do WhatsApp (com c√≥digo do pa√≠s, ex: 5511999999999):");
    if (!telefone) return;

    const diaFormatado = dia.toString().padStart(2, '0');
    const mesFormatado = (mes + 1).toString().padStart(2, '0');
    
    const caminho = `agendamentos/${ano}/${mes+1}/${dia}/${horario}`;
    set(ref(db, caminho), {
        nome,
        servico: servicoSelecionado,
        telefone,
        data: `${diaFormatado}/${mesFormatado}/${ano}`,
        horario
    });

    // Enviar mensagem via WhatsApp
    const mensagem = `Ol√°! Seu agendamento foi confirmado:\n\n` +
                    `üìÖ Data: ${diaFormatado}/${mesFormatado}/${ano}\n` +
                    `üïê Hor√°rio: ${horario}\n` +
                    `‚úÇÔ∏è Servi√ßo: ${servicoSelecionado}\n` +
                    `üë§ Cliente: ${nome}\n\n` +
                    `Obrigado por escolher nossa barbearia!`;
    
    const whatsappUrl = `https://wa.me/${telefone}?text=${encodeURIComponent(mensagem)}`;
    
    alert("Agendamento realizado com sucesso! Voc√™ ser√° redirecionado para o WhatsApp.");
    window.open(whatsappUrl, '_blank');
}

// ------------------------------------------
// 8. INICIAR CALEND√ÅRIO
// ------------------------------------------
const hoje = new Date();
gerarCalendario(hoje.getFullYear(), hoje.getMonth());

</script>

</body>
</html>